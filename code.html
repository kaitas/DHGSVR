import React, { useState, useEffect, useRef } from 'react';

const styles = `
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap');

body {
    font-family: 'Zen Kaku Gothic New', sans-serif;
    background-color: #0f172a;
    color: #e2e8f0;
    overflow-x: hidden;
}
.font-mono {
    font-family: 'JetBrains Mono', monospace;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
    width: 8px;
}
::-webkit-scrollbar-track {
    background: #0f172a; 
}
::-webkit-scrollbar-thumb {
    background: #334155; 
    border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
    background: #475569; 
}

/* Animated Background */
.bg-grid {
    background-size: 50px 50px;
    background-image: 
        linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
    mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
    -webkit-mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
    pointer-events: none;
}

/* Card Hover Effects */
.link-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.link-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
    border-color: rgba(56, 189, 248, 0.5);
}

/* Glitch Effect for Title */
.glitch-text {
    position: relative;
}
.glitch-text::before,
.glitch-text::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #0f172a;
}
.glitch-text::before {
    left: 2px;
    text-shadow: -1px 0 #00ffea;
    clip: rect(24px, 550px, 90px, 0);
    animation: glitch-anim-2 3s infinite linear alternate-reverse;
}
.glitch-text::after {
    left: -2px;
    text-shadow: -1px 0 #ff005d;
    clip: rect(85px, 550px, 140px, 0);
    animation: glitch-anim 2.5s infinite linear alternate-reverse;
}
@keyframes glitch-anim {
    0% { clip: rect(11px, 9999px, 89px, 0); }
    20% { clip: rect(68px, 9999px, 14px, 0); }
    40% { clip: rect(23px, 9999px, 57px, 0); }
    60% { clip: rect(93px, 9999px, 92px, 0); }
    80% { clip: rect(4px, 9999px, 28px, 0); }
    100% { clip: rect(51px, 9999px, 7px, 0); }
}
@keyframes glitch-anim-2 {
    0% { clip: rect(65px, 9999px, 100px, 0); }
    20% { clip: rect(9px, 9999px, 22px, 0); }
    40% { clip: rect(60px, 9999px, 7px, 0); }
    60% { clip: rect(32px, 9999px, 55px, 0); }
    80% { clip: rect(4px, 9999px, 36px, 0); }
    100% { clip: rect(79px, 9999px, 4px, 0); }
}
`;

// Icons components
const ExternalLinkIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
);

const CopyIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
);

const CheckIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#4ade80" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
);

const SearchIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
);

// Data
const rawLinks = [
    "https://akihiko.shirai.as/DHGSVR/",
    "https://c426.github.io/",
    "https://sonobemasashi-web.github.io/github.io/",
    "https://final-ke.github.io/",
    "https://isa251.github.io",
    "https://github.com/g241tg2054-png/g241tg2054.github.io",
    "https://marinakawaguchi.com/",
    "https://tofumisoshiru.github.io/DHGSVR/",
    "https://lovpipit.github.io/",
    "https://floriahimmel.github.io/4Q_Floria/",
    "https://anine998.github.io",
    "https://saia-ui.github.io/",
    "https://siraha0611.github.io/kaso-katsumata.github.io/"
];

// Process links
const processLinks = (urls) => {
    return urls.map((url, index) => {
        let name = "Portfolio";
        let tag = "Web";
        
        try {
            const urlObj = new URL(url);
            const path = urlObj.pathname.replace(/\/$/, ""); 
            
            if (url.includes("akihiko.shirai")) name = "Akihiko Shirai";
            else if (url.includes("marinakawaguchi")) name = "Marina Kawaguchi";
            else if (url.includes("github.com")) {
                name = "Repository / Project";
                tag = "Source";
            }
            else if (url.includes("github.io")) {
                const subdomain = urlObj.hostname.split('.')[0];
                name = subdomain;
                if (name === "sonobemasashi-web") name = "Sonobe Masashi";
                if (name === "tofumisoshiru") name = "Tofu Misoshiru";
                if (name === "final-ke") name = "Final-ke";
                if (name === "siraha0611") name = "Siraha / Kaso";
                
                if (path.length > 1 && !path.includes("github.io")) {
                    const subProject = path.split('/').pop();
                    if(subProject) name += ` / ${subProject}`;
                }
            }
        } catch (e) {
            name = "Unknown Link";
        }

        return {
            id: index,
            url: url,
            name: name.charAt(0).toUpperCase() + name.slice(1),
            tag: tag
        };
    });
};

// Particle System Component
const ParticleBackground = () => {
    const canvasRef = useRef(null);
    const particles = useRef([]);
    const mouse = useRef({ x: -1000, y: -1000 }); // Initial far away position

    useEffect(() => {
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        let animationFrameId;

        const resizeCanvas = () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initParticles();
        };

        const initParticles = () => {
            particles.current = [];
            // Increased to 1000 particles as requested
            const particleCount = 1000; 
            
            for (let i = 0; i < particleCount; i++) {
                particles.current.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    originalVx: (Math.random() - 0.5) * 0.5,
                    originalVy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() * 1.5 + 0.5, // Slightly smaller size for dense particles
                    color: `rgba(${Math.floor(Math.random()*100)}, ${Math.floor(Math.random()*200 + 55)}, ${Math.floor(Math.random()*255)}, ${Math.random() * 0.3 + 0.1})`
                });
            }
        };

        const animate = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            particles.current.forEach(p => {
                // Basic movement
                p.x += p.vx;
                p.y += p.vy;

                // Mouse interaction (Repel)
                const dx = mouse.current.x - p.x;
                const dy = mouse.current.y - p.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const repelDistance = 150;

                if (distance < repelDistance) {
                    const angle = Math.atan2(dy, dx);
                    const force = (repelDistance - distance) / repelDistance;
                    const repelStrength = 2; // Strength of repulsion

                    p.vx -= Math.cos(angle) * force * repelStrength;
                    p.vy -= Math.sin(angle) * force * repelStrength;
                } else {
                    // Return to original speed (friction/restoration)
                    p.vx += (p.originalVx - p.vx) * 0.05;
                    p.vy += (p.originalVy - p.vy) * 0.05;
                }

                // Bounce off edges
                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                // Draw
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = p.color;
                ctx.fill();
            });

            // Connect nearby particles with lines
            // Optimized: Only connect the first 150 particles to maintain performance with 1000 dots
            const connectCount = Math.min(particles.current.length, 150);
            
            for (let i = 0; i < connectCount; i++) {
                const p1 = particles.current[i];
                for (let j = i + 1; j < connectCount; j++) {
                    const p2 = particles.current[j];
                    const dx = p1.x - p2.x;
                    const dy = p1.y - p2.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < 100) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(56, 189, 248, ${0.1 * (1 - dist / 100)})`; // Sky blue faint lines
                        ctx.lineWidth = 1;
                        ctx.moveTo(p1.x, p1.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.stroke();
                    }
                }
            }

            animationFrameId = requestAnimationFrame(animate);
        };

        const handleMouseMove = (e) => {
            mouse.current = { x: e.clientX, y: e.clientY };
        };
        
        const handleMouseLeave = () => {
            mouse.current = { x: -1000, y: -1000 };
        }

        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('mousemove', handleMouseMove);
        window.addEventListener('mouseout', handleMouseLeave);
        
        resizeCanvas();
        animate();

        return () => {
            window.removeEventListener('resize', resizeCanvas);
            window.removeEventListener('mousemove', handleMouseMove);
            window.removeEventListener('mouseout', handleMouseLeave);
            cancelAnimationFrame(animationFrameId);
        };
    }, []);

    return <canvas ref={canvasRef} className="fixed inset-0 pointer-events-none z-[-2]" />;
};

const Card = ({ item }) => {
    const [copied, setCopied] = useState(false);

    const handleCopy = (e) => {
        e.preventDefault();
        e.stopPropagation();
        const textArea = document.createElement("textarea");
        textArea.value = item.url;
        document.body.appendChild(textArea);
        textArea.select();
        try {
           document.execCommand('copy');
           setCopied(true);
           setTimeout(() => setCopied(false), 2000);
        } catch (err) {
           console.error('Copy failed', err);
        }
        document.body.removeChild(textArea);
    };

    return (
        <a 
            href={item.url} 
            target="_blank" 
            rel="noopener noreferrer"
            className="link-card group relative flex flex-col justify-between p-6 bg-slate-800/40 backdrop-blur-md border border-slate-700 rounded-xl hover:bg-slate-800/60 cursor-pointer overflow-hidden z-10"
        >
            {/* Decorative Gradient Blob */}
            <div className="absolute -top-10 -right-10 w-32 h-32 bg-sky-500/20 rounded-full blur-3xl group-hover:bg-sky-400/30 transition-all duration-500"></div>

            <div>
                <div className="flex justify-between items-start mb-4">
                    <span className={`text-xs font-mono px-2 py-1 rounded border ${item.tag === 'Source' ? 'bg-purple-500/10 border-purple-500/30 text-purple-300' : 'bg-sky-500/10 border-sky-500/30 text-sky-300'}`}>
                        {item.tag}
                    </span>
                    <ExternalLinkIcon />
                </div>
                
                <h3 className="text-xl font-bold text-white mb-1 tracking-tight group-hover:text-sky-300 transition-colors">
                    {item.name}
                </h3>
                
                <p className="text-slate-400 text-xs font-mono truncate opacity-70 group-hover:opacity-100 transition-opacity">
                    {item.url}
                </p>
            </div>

            <div className="mt-6 flex justify-end">
                <button 
                    onClick={handleCopy}
                    className="p-2 rounded-lg bg-slate-700/50 hover:bg-slate-600 text-slate-300 hover:text-white transition-colors border border-transparent hover:border-slate-500 z-10"
                    title="Copy URL"
                >
                    {copied ? <CheckIcon /> : <CopyIcon />}
                </button>
            </div>
        </a>
    );
};

export default function App() {
    const [query, setQuery] = useState("");
    const [links, setLinks] = useState([]);

    useEffect(() => {
        setLinks(processLinks(rawLinks));
    }, []);

    const filteredLinks = links.filter(link => 
        link.name.toLowerCase().includes(query.toLowerCase()) || 
        link.url.toLowerCase().includes(query.toLowerCase())
    );

    return (
        <div className="min-h-screen relative w-full pb-20 text-slate-200">
            <style>{styles}</style>
            
            {/* Interactive Particles */}
            <ParticleBackground />

            {/* Background Grid (Static Texture) */}
            <div className="fixed inset-0 bg-grid z-[-1]"></div>
            <div className="fixed top-0 left-0 w-full h-full bg-gradient-to-b from-slate-900/0 to-slate-900/90 pointer-events-none z-[-1]"></div>

            {/* Header */}
            <header className="pt-20 pb-12 px-6 flex flex-col items-center justify-center text-center relative z-10">
                <h1 className="text-5xl md:text-7xl font-bold mb-4 tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-600 glitch-text" data-text="PORTAL_INDEX">
                    PORTAL_INDEX
                </h1>
                <p className="text-slate-400 max-w-lg mx-auto font-mono text-sm md:text-base">
                    Access Points for Creative Portfolios & VR Projects.
                    <br/>
                    <span className="opacity-50">Total Links: {links.length}</span>
                </p>
            </header>

            {/* Search Bar */}
            <div className="max-w-xl mx-auto px-6 mb-16 relative z-10">
                <div className="relative group">
                    <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-500 group-focus-within:text-sky-400 transition-colors">
                        <SearchIcon />
                    </div>
                    <input 
                        type="text"
                        placeholder="Search by name or URL..."
                        value={query}
                        onChange={(e) => setQuery(e.target.value)}
                        className="w-full bg-slate-800/80 backdrop-blur border border-slate-700 text-white rounded-full py-4 pl-12 pr-6 focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all shadow-lg placeholder:text-slate-500"
                    />
                    <div className="absolute inset-0 -z-10 bg-sky-500/5 rounded-full blur-xl group-focus-within:bg-sky-500/10 transition-all"></div>
                </div>
            </div>

            {/* Grid */}
            <main className="max-w-7xl mx-auto px-6 relative z-10">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {filteredLinks.length > 0 ? (
                        filteredLinks.map(link => (
                            <Card key={link.id} item={link} />
                        ))
                    ) : (
                        <div className="col-span-full text-center py-20">
                            <p className="text-slate-500 font-mono text-lg">No signals found.</p>
                        </div>
                    )}
                </div>
            </main>

            {/* Footer */}
            <footer className="text-center mt-20 text-slate-600 text-sm font-mono relative z-10">
                <p>GENERATED_BY_SYSTEM // {new Date().getFullYear()}</p>
            </footer>
        </div>
    );
}